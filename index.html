<tt>
<h2>Mini Sand</h2>

<p>A 2D sand simulator in 618 bytes

<pre style="background:#222;color:#fff;padding:10px;word-wrap:break-word;white-space:pre;width:450px;position:relative;font-size:12px">
for(c=a.getContext("2d"),w=300,h=150,d=[],E={},m=0,i=150;i--;)
for(d[i]=[],j=300;j--;)d[i][j]=Math.random()&lt;.2;setInterval
((()=>{for(a.width^=0,m&&(d[E.offsetY/3|0][E.offsetX/3|0]=1),i
=150;i--;)for(j=300;j--;)i&lt;149&&d[i][j]&&(d[i+1][j]?0!=j&&!
d[i+1][j-1]||d[i+1][j+1]?!j||299!=j&&!d[i+1][j+1]||d[i+1][j-1]
?j&&j&lt;299&&!d[i+1][j+1]&&!d[i+1][j-1]&&(o=Math.random()&lt;
.5?1:-1,d[i+1][j+o]=1,d[i][j]=0):(d[i+1][j-1]=1,d[i][j]=0):(d[
i+1][j+1]=1,d[i][j]=0):(d[i+1][j]=1,d[i][j]=0));for(i=150;i--;
)for(j=300;j--;)i&lt;149&&d[i][j]&&d[i][j]&&c.fillRect(j,i,1,1
)}),33),onmousedown=i=>(m=1,E=i),onmouseup=i=>(m=0,E=i),
onmousemove=i=>E=i;</pre>

<canvas id=a style="border: 1px solid; width:900px; height:450px"></canvas>

<script>
c=a.getContext("2d");
w=300;
h=150;
d=[];
E={};
m=0;
for(i=150;i--;){
  d[i]=[];
  for(j=300;j--;){
    d[i][j]=Math.random()<.2;
  }
}
setInterval(()=>{
  a.width^=0;
  if(m){
    d[E.offsetY/3|0][E.offsetX/3|0]=1;
  }
  for(i=150;i--;){
    for(j=300;j--;){
      if(i<149&&d[i][j]){
      
        // Just below
        if(!d[i+1][j]){
          d[i+1][j]=1;
          d[i][j]=0;
        }
        
        // Right
        else if((j==0||d[i+1][j-1])&&!d[i+1][j+1]){
          d[i+1][j+1]=1;
          d[i][j]=0;
        }
        
        // Left
        else if((j&&(j==299||d[i+1][j+1]))&&!d[i+1][j-1]){
          d[i+1][j-1]=1;
          d[i][j]=0;
        }
        
        // Both: random
        else if(j&&j<299&&!d[i+1][j+1]&&!d[i+1][j-1]){
          o=Math.random()<.5?1:-1;
          d[i+1][j+o]=1;
          d[i][j]=0;
        }
      }
    }
  }
  for(i=150;i--;){
    for(j=300;j--;){
      if(i<149 && d[i][j]){
       if(d[i][j])c.fillRect(j,i,1,1);
      }
    }
  }
},33);
onmousedown=e=>(m=1,E=e);
onmouseup=e=>(m=0,E=e);
onmousemove=e=>E=e;

</script>